<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <title><%= @recipe.name %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <style>
.tab-content {
  display: none;
}
        .tab-content.active {
          display: block;
        }
        .tab-btn.active {
          background-color: #92b7cc; /* Cookbase blue for active color */
          color: #fff; /* White text for better contrast */
        }

        /* Custom styling for list numbers */
        #directions ol.list-decimal li::marker {
          font-weight: bold;
          color: #92b7cc; /* Tailwind's gray-700 */
          font-size: 1.25rem; /* Equivalent to text-xl */
        }
    </style>
  </head>

  <body>
    <div class="flex justify-center items-center sm:mx-4 md:mx-0 mt-6 mb-4">
      <%= image_tag(recipe_image(@recipe), loading: "eager", class: "rounded-lg shadow-md w-full max-w-xs sm:max-w-sm md:max-w-md") %>
    </div>

    <h2 class="text-center text-4xl font-semibold text-gray-800 mb-6 leading-snug">
      <%= @recipe.name %>
    </h2>

    <div class="max-w-4xl mx-auto mt-8 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
      <div class="relative mb-6">
        <label for="scale-range" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Multiply your recipe</label>
        <input id="scale_range" type="range" min="0.5" max="5" value="1" step="0.5" data-remote="true" data-url="<%= scale_recipe_path(@recipe) %>" data-method="post" class="w-full h-3 bg-gray-200 rounded-lg cursor-pointer range-lg dark:bg-gray-700" oninput="updateScale(this.value)">
        <div class="flex justify-between mt-2 text-xs text-gray-600">
          <span class="w-8 text-left">0.5</span>
          <span class="w-8 text-center">1x</span>
          <span class="w-8 text-center">1.5x</span>
          <span class="w-8 text-center">2x</span>
          <span class="w-8 text-center">2.5x</span>
          <span class="w-8 text-center">3x</span>
          <span class="w-8 text-center">3.5x</span>
          <span class="w-8 text-right">4x</span>
          <span class="w-8 text-right">4.5x</span>
          <span class="w-8 text-right">5x</span>
        </div>
      </div>
    </div>

    <div class="mt-8 sm:hidden">
      <!-- Tab Headers -->
      <div class="tab-headers flex justify-center space-x-4 mb-4">
        <button class="tab-btn active bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-300" onclick="switchTab('ingredients')">Ingredients</button>
        <button class="tab-btn bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-300" onclick="switchTab('directions')">Directions</button>
      </div>

      <!-- Tab Content -->
      <div id="ingredients" class="tab-content active">
        <%= turbo_frame_tag "mobile_scaled_ingredients" do %>
          <div class="mb-6 px-4 sm:px-6 lg:px-8">
            <h3 class="text-3xl text-gray-700 font-semibold mb-4">Ingredients</h3>
            <ul class="list-disc list-inside space-y-2">
              <% @recipe.ingredients.each do |ingredient| %>
                <li class="flex items-center">
                  <span class="text-gray-700 font-medium">
                    <%= number_with_precision(ingredient[:scaled_quantity], precision: 2) %> 
                    <%= ingredient.name %>
                  </span>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>

      <div id="directions" class="tab-content hidden">
        <div class="mb-6 px-4 sm:px-6 lg:px-8">
          <h3 class="text-3xl text-gray-700 font-semibold mb-4">Directions</h3>
          <ol class="list-decimal list-inside space-y-2">
            <% begin %>
              <% JSON.parse(@recipe.directions).each do |direction| %>
                <li class="text-gray-700 leading-relaxed">
                  <%= direction %>
                </li>
              <% end %>
            <% rescue %>
              <% @recipe.directions.split("\n").each do |step| %>
                <li class="text-gray-700 leading-relaxed">
                  <%= step.strip %>
                </li>
              <% end %>
            <% end %>
          </ol>
        </div>
      </div>
      <div class="mb-6 px-4 sm:px-6 lg:px-8">
        <div class="mb-4">
          <h3 class="text-xl font-bold mb-2">Notes</h3>
          <p><%= simple_format(@recipe.notes) %></p>
        </div>

        <div class="mb-4">
          <h3 class="text-xl font-bold mb-2">URL</h3>
          <%= link_to @recipe.url, @recipe.url, class: 'underline' %>
        </div>

        <div class="flex justify-between mt-6">
          <%= link_to 'Edit', edit_recipe_path(@recipe), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
          <%= link_to 'Back', recipes_path, class: 'bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded' %>
          <%= link_to 'Delete', recipe_path(@recipe), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this recipe? Deleting a recipe cannot be undone.' }, method: :delete, class: 'bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded' %>
        </div>
      </div>

    </div>

    <div class="hidden sm:flex">
      <div class="max-w-4xl mx-auto mt-8 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">

        <p>
        <strong>Tags:</strong>
        <%= @recipe.tag_list.join(", ") %>
        </p>

        <%= turbo_frame_tag "desktop_scaled_ingredients" do %>
          <div class="mb-4">
            <h3 class="text-xl font-bold mb-2">Ingredients</h3>
            <ul class="list-disc list-inside">
              <% @recipe.ingredients.each do |ingredient| %>
                <li class="text-gray-700"><%= number_with_precision(ingredient[:scaled_quantity], precision: 2) %> <%= ingredient.name %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="mb-4">
          <h3 class="text-xl font-bold mb-2">Directions</h3>
          <ol class="list-decimal list-inside">
            <% begin %>
              <% JSON.parse(@recipe.directions).each do |direction| %>
                <li class="text-gray-700"><%= direction %></li>
              <% end %>
            <% rescue %>
              <% @recipe.directions.split("\n").each do |step| %>
                <li class="text-gray-700"><%= step.strip %></li>
              <% end %>
            <% end %>
          </ol>
        </div>

        <div class="mb-4">
          <h3 class="text-xl font-bold mb-2">Notes</h3>
          <p><%= simple_format(@recipe.notes) %></p>
        </div>

        <div class="mb-4">
          <h3 class="text-xl font-bold mb-2">URL</h3>
          <%= link_to @recipe.url, @recipe.url, class: 'underline' %>
        </div>

        <div class="flex justify-between mt-6">
          <%= link_to 'Edit', edit_recipe_path(@recipe), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
          <%= link_to 'Back', recipes_path, class: 'bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded' %>
          <%= link_to 'Delete', recipe_path(@recipe), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this recipe? Deleting a recipe cannot be undone.' }, method: :delete, class: 'bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded' %>
        </div>
      </div>
    </div>

    <script>
      // Tab Switching
      function switchTab(tab) {
        const tabs = document.querySelectorAll('.tab-content');
        const buttons = document.querySelectorAll('.tab-btn');

        // Hide all tab contents
        tabs.forEach(t => {
          t.classList.remove('active');
        });

        // Remove active class from all buttons
        buttons.forEach(btn => {
          btn.classList.remove('active');
        });

        // Show the selected tab content
        document.getElementById(tab).classList.add('active');

        // Set the active class on the clicked button
        buttons.forEach(btn => {
          if (btn.textContent.trim().toLowerCase() === tab) {
            btn.classList.add('active');
          }
        });
      }

      // Scale factor update
      function updateScale(scaleFactor) {
        const recipeId = <%= @recipe.id %>;
        fetch(`/recipes/${recipeId}/scale?scale_factor=${scaleFactor}`, {
          headers: { 'Accept': 'text/vnd.turbo-stream.html' }
        })
          .then(response => response.text())
          .then(html => Turbo.renderStreamMessage(html));
      }
    </script>
  </body>

</html>
